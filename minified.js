var cookies=["_gat_gtag_UA_152532440_1","_ga","_gid","disclaimer","allowCookies","cookieBanner","lang","colorblind"],USECOOKIES=!1;function showCookieBanner(){if(""===getCookie("allowCookies")){document.getElementById("cookie-modal").style.display="block"}else{document.getElementById("cookie-modal").style.display="none",USECOOKIES=!0,initGoogleAnalytics();let e=getCookie("colorblind");COLORBLIND=""!==e&&"false"!==e}}function initGoogleAnalytics(){}function saveCookieAccept(){document.getElementById("cookie-modal").style.display="none",USECOOKIES=!0,console.log("cookies accepted."),initGoogleAnalytics(),setCookie("allowCookies",!0,365),setCookie("colorblind",COLORBLIND,365)}function setCookie(e,t,n){var r=new Date;r.setTime(r.getTime()+24*n*60*60*1e3);var i="expires="+r.toUTCString();document.cookie=e+"="+t+";"+i+";path=/"}function getCookie(e){for(var t=e+"=",n=decodeURIComponent(document.cookie).split(";"),r=0;r<n.length;r++){for(var i=n[r];" "==i.charAt(0);)i=i.substring(1);if(0==i.indexOf(t))return i.substring(t.length,i.length)}return""}function saveCookieDecline(){document.getElementById("cookie-modal").style.display="none",console.log("cookies declined."),window["ga-disable-UA-152532440-1"]=!0,USECOOKIES=!1;for(let e=0;e<cookies.length;e++)setCookieExpired(cookies[e])}function setCookieExpired(e){document.cookie=e+"=; expires=Thu, 01 Jan 1970 00:00:00 UTC; path=/;"}var WORLD=!0,TREND_ENABLED=!1,COLORBLIND=!1,now=moment(),growth_radio={},absolute=!0,fallz_radiostate="radio_trend",tweeksago_strng="",lastInfoBoxFeature=null,districtInfo=[],showTrend=!1;function diseaseCount2Int(e){for(let t=0;t<e.features.length;t++)e.features[t].properties.Anzahl=parseInt(e.features[t].properties.Anzahl)}function getPercentile(e,t){var n=[],r=getLastDate(e);return e.features.forEach(e=>{n.push(e.properties.disease[r])}),calcPercentile(n,t)}function getDates(e){var t=e.features[0].properties.disease,n=Object.keys(t).map(e=>new Date(Date.parse(e)));return n=(n=n.sort((e,t)=>e-t)).map(e=>moment(e).format("YYYY-MM-DD"))}function generateFeatureIDs(e){for(let t=0;t<e.features.length;t++)e.features[t].id=t}let csv_table;function onTableLoaded(e){csv2GeoJSON(csv_table=e.data,district_map),WORLD||generateFeatureIDs(district_map),document.body.style["pointer-events"]="",loadData(WORLD?"https://vis.csh.ac.at/riskpatients/disease_rate_global.json?t="+now:"https://vis.csh.ac.at/riskpatients/disease_rate.json?t="+now,onCurrentDiseaseRateLoaded)}function csv2GeoJSON(e,t){let n=e[0];if(WORLD)return;for(let r=1;r<e.length;r++){let i=e[r],a=getFeatureID(t,i[1]);if(void 0!=a)for(let e=2;e<n.length;e++)t.features[a].properties[n[e]]=parseFloat(i[e])}let r={};for(let t=2;t<n.length;t++){let i=null,a=0;for(j=1;j<e.length;j++){let n=parseFloat(e[j][t]);n>a&&(a=n),null==i&&(i=n),n<i&&(i=n)}r[n[t]]={},r[n[t]].min=i,r[n[t]].max=a}t.minMaxDict=r}function getFeatureID(e,t){let n=!1;for(let r=0;r<e.features.length;r++)if(e.features[r].properties.name==t)return n=!0,r;console.warn("did not find: "+t+" in the feature set.")}function setupRadioButtons(){if(!TREND_ENABLED)return;let e=document.getElementById("radio_amp");e.setAttribute("onChange","onRadioGrowth(value)"),e.setAttribute("checked","checked"),document.getElementById("radio_trend").setAttribute("onChange","onRadioGrowth(value)")}function onRadioGrowth(e){fallz_radiostate=e,"radio_trend"==e?(showTrend=!0,switchMapLayer("trendcolor"),document.getElementById("radio_amp").setAttribute("checked","false")):"radio_amp"==e&&(showTrend=!1,switchMapLayer("severity"),document.getElementById("radio_trend").setAttribute("checked","false"))}function setupWelcomeMsg(){let e;return e=WORLD?"<h5>"+dictionary.welcomeGlobal0+"</h5>"+dictionary.welcomeGlobal1:"<h5>"+dictionary.welcomeAT0+"</h5>"+dictionary.welcomeAT1}function generateInfoBoxContent(e){lastInfoBoxFeature=e;var t=e.properties.name;e.properties.name.startsWith("Wien ")&&(t="Wien(Stadt)");var n=findInfectionDataForDistrictName(t),r=n.infectionCount;var i="<h5>"+e.properties.name+"</h5>";if(TREND_ENABLED&&(i="<h5>"+e.properties.name+'<img src="./assets/arrow.png" alt="trend indicator" id="trend" class="tooltipped" data-tooltip="Trend = Steigungswinkel der Zwei-Wochen-Kurve"></h5>'),e.properties.name.startsWith("Wien ")?i+="<p><b>Anzahl insgesamt positiv Getesteter (gesamt Wien): </b><span class='info-value'>"+r.toLocaleString(lang)+"</span><b>Anzahl positiv Getesteter (gesamt Wien) seit "+tweeksago_strng+":</b><span class='info-value'>"+n.newInfections.toLocaleString(lang,{maximumFractionDigits:1})+"</span><br><b>Wachstumsrate (gesamt Wien): </b><span class='info-value'>"+n.growth.toLocaleString(lang,{maximumFractionDigits:1})+"%</span></p>":i+="<p><b>"+dictionary.infobox0+": </b><span class='info-value'>"+r.toLocaleString(lang)+"</span><br><b>"+dictionary.infobox1+tweeksago_strng+": </b><span class='info-value'>"+n.newInfections.toLocaleString(lang,{maximumFractionDigits:1})+"</span></p>",WORLD)i+="<p><b>"+dictionary.infobox2+": </b><span class='info-value'>"+getDistrictInhabsByIso(e.properties.name).toLocaleString(lang)+'</span></p><br><br><canvas id="myChartInfobx" width="400" height="400"></canvas>';else{var a=findDataForDistrictName(e.properties.name),o=a["Risiko durch Vorerkrankungen, 65+_abs"],s=(100*o/a["Gesamtbevölkerung_abs"]).toLocaleString(lang,{maximumFractionDigits:1});i+="<p><b>"+dictionary.infobox4+" </b><span class='info-value'>"+a.Allgemeinmedizin_abs.toLocaleString(lang)+"</span></p><p><b>"+dictionary.infobox5+" </b><span class='info-value'>"+a.Allgemeinmedizin_rel.toLocaleString(lang,{maximumFractionDigits:1})+"</span></p><p><b>"+dictionary.infobox6+" </b><span class='info-value'>"+o.toLocaleString(lang)+"</span></p><p><b>"+dictionary.infobox7+" </b><span class='info-value'>"+s.toLocaleString(lang,{maximumFractionDigits:1})+"%</span></p><p><b>"+dictionary.infobox2+": </b><span class='info-value'>"+a["Gesamtbevölkerung_abs"].toLocaleString(lang)+'</span></p><br><br><canvas id="myChartInfobx" width="400" height="400"></canvas>'}return i}function findInfectionDataForDistrictName(e){for(var t=0;t<fileresult.features.length;t++)if(fileresult.features[t].properties.name==e)return fileresult.features[t].properties}function findDataForDistrictName(e){if("Wien(Stadt)"==e){var t=null;for(var n=0;n<district_map.features.length;n++)district_map.features[n].properties.name.startsWith("Wien ")&&(null==t&&(t=Object.assign({},district_map.features[n].properties)),t["Risiko durch Vorerkrankungen, 65+_abs"]+=district_map.features[n].properties["Risiko durch Vorerkrankungen, 65+_abs"],t["Gesamtbevölkerung_abs"]+=district_map.features[n].properties["Gesamtbevölkerung_abs"],t.Allgemeinmedizin_rel+=district_map.features[n].properties.Allgemeinmedizin_rel,t.Allgemeinmedizin_abs+=district_map.features[n].properties.Allgemeinmedizin_abs);return t.Allgemeinmedizin_rel=t.Allgemeinmedizin_rel/23,t}for(n=0;n<district_map.features.length;n++)if(district_map.features[n].properties.name==e)return district_map.features[n].properties}function loadCSVData(e,t,n){Papa.parse(e,new parsecfg(t,n))}function parsecfg(e,t){this.delimiter=t,this.newline="",this.complete=e,this.download=!0}let unparseCfg={delimiter:";"};function saveJSONAsFile(e,t){saveStringAsFile(JSON.stringify(e),t)}function saveStringAsFile(e,t){var n=new Blob([e],{type:"text/plain"});url=URL.createObjectURL(n);var r=document.createElement("a");r.setAttribute("href",url),r.setAttribute("download",t);var i=document.createEvent("MouseEvents");i.initMouseEvent("click",!0,!0,window,1,0,0,0,0,!1,!1,!1,!1,0,null),r.dispatchEvent(i)}function loadData(e,t){var n=new XMLHttpRequest;n.onreadystatechange=t,n.open("GET",e,!0),n.send()}function parseJSONCallback(){if(4==this.readyState&&200==this.status)return console.log("data loaded..."),JSON.parse(this.responseText)}var districtData,fileresult,sliderDate,district_map,popup=new mapboxgl.Popup({closeButton:!1}),hoveredStateId=null,dates=[],percentile=.9,percentileThreshold=300,newlyInfectedPercentile=0,maxGrowth=0,layers=[],timeSliderContainer=null,selectedTimeValue=null,currentSliderIndex=null,trendGradientMode=!0,timescope=42,trendcolorscale=chroma.scale(["red","white","lightgreen"]).domain([-90,0,90]).mode("lab"),cbgreen="#83C775",cbyellow="#FFDE17",cbred="#8E191C",regred="#ff3c00",regyellow="#fff200",reggreen="#00ba32",cred="#ff3c00",cyellow="#fff200",cgreen="#00ba32",regredbox="rgba(255, 0, 0, 0.3)",reggreenbox="rgba(0, 255, 0, 0.3)",regyellowbox="rgba(255, 255, 0, 0.3)",cbredbox="rgba(142, 25, 28, 0.3)",cbgreenbox="rgba(131, 199, 117, 0.3)",cbyellowbox="rgba(255, 222, 23, 0.3)",redbox="rgba(255, 0, 0, 0.3)",greenbox="rgba(0, 255, 0, 0.3)",yellowbox="rgba(255, 255, 0, 0.3)";function handleColorBlindModeChange(e){e.stopPropagation(),toggleColorBlind(!COLORBLIND),updateMapAndLegend()}function toggleColorBlind(e){e?(cred=cbred,cyellow=cbyellow,cgreen=cbgreen,redbox=cbredbox,greenbox=cbgreenbox,yellowbox=cbyellowbox):(cred=regred,cyellow=regyellow,cgreen=reggreen,redbox=regredbox,greenbox=reggreenbox,yellowbox=regyellowbox),COLORBLIND=e,USECOOKIES&&setCookie("colorblind",e,365)}function updateMapAndLegend(){calcSeverity(fileresult.features,csv_table),map.getSource("infection_rates").setData(fileresult),updateLegend()}function onCurrentDiseaseRateLoaded(){4==this.readyState&&200==this.status&&(console.log("data loaded..."),fileresult=JSON.parse(this.responseText),toggleColorBlind(COLORBLIND),diseaseCount2Int(fileresult),configureSlider(fileresult),calcGrowRate(fileresult.features),calcNewInfections(fileresult.features),calcMaxNewInfections(fileresult.features),calcSeverity(fileresult.features,csv_table),generateFeatureIDs(fileresult),TREND_ENABLED&&calcInfectionTrends(fileresult.features),percentileThreshold=calculatePercentile(fileresult),newlyInfectedPercentile=calculateNewlyInfectedPercentile(fileresult),map.addSource("infection_rates",{type:"geojson",data:fileresult}),map.addLayer({id:"infection_poly",type:"fill",source:"infection_rates",layout:{},paint:{"fill-color":["get","severity"],"fill-opacity":["case",["boolean",["feature-state","hover"],!1],1,.8]}}),layers.push("infection_poly"),switchInfectionLayerEncoding("Anzahl (max: 0,9 Quantil)","newInfections",0,newlyInfectedPercentile,null,null,"der maximal Wert der Farbscala entspricht dem 0.9 Quantil der Anzahl an Neuinfizierten im Vergleich zum Stand vor 14 Tagen."),updateLegend(),map.addLayer({id:"district_borders",type:"line",source:"infection_rates",layout:{},paint:{"line-color":"#242629","line-width":1}}),layers.push("district_borders"),map.on("mousemove","infection_poly",function(e){if(e.features.length>0){let t="";t="<b>"+e.features[0].properties.name+"</b><br>"+parseFloat(e.features[0].properties.infectionsPerHT).toLocaleString(lang)+dictionary.popup0+tweeksago_strng,popup.setLngLat(e.lngLat).setHTML(t+'<br><br><canvas id="myChart" width="400" height="400"></canvas>').addTo(map),setupChart(e.features[0],"myChart"),map.getCanvas().style.cursor="pointer",hoveredStateId&&map.setFeatureState({source:"infection_rates",id:hoveredStateId},{hover:!1}),hoveredStateId=e.features[0].id,map.setFeatureState({source:"infection_rates",id:hoveredStateId},{hover:!0})}}),map.on("mouseleave","infection_poly",function(){hoveredStateId&&map.setFeatureState({source:"infection_rates",id:hoveredStateId},{hover:!1}),hoveredStateId=null,map.getCanvas().style.cursor="",popup.remove()}),map.on("click","infection_poly",function(e){if(e.features.length>0){showInfoBox(generateInfoBoxContent(e.features[0])),setupChart(e.features[0],"myChartInfobx"),updateArrow("trend",fileresult.features[e.features[0].id].properties.trend)}else hideInfoBox()}),updateTimelineSlider(Date.parse(dates[dates.length-1])),setupRadioButtons())}function setupChart(e,t){let n=fileresult.features[e.id].properties.newInfectionsArray;var r=[],i={};showTrend?(r=[{x:date_strngArray[currentSliderIndex-14],y:n[currentSliderIndex-14]},{x:date_strngArray[currentSliderIndex],y:n[currentSliderIndex]}],i={labels:date_strngArray,datasets:[{label:"Positiv Getestete innerhalb von 14 Tagen",borderColor:"rgb(255, 99, 132)",data:n},{label:"Zwei-Wochen Trend",borderColor:"rgb(100, 99, 100)",data:r}]}):i={labels:date_strngArray,datasets:[{label:dictionary.infobox3,borderColor:"rgb(255, 99, 132)",data:n}]};var a=document.getElementById(t).getContext("2d");new Chart(a,{type:"line",data:i,options:{animation:!1,scales:{yAxes:[{ticks:{beginAtZero:!0,suggestedMax:fileresult.features[e.id].properties.redMaxInhabitants}}]},legend:{labels:{usePointStyle:!0,boxWidth:4}},tooltips:{callbacks:{label:function(e,t){var n,r;let i;return"de"==lang?(n=e.label.split(". "),r=new Date(n[2],n[1]-1,n[0])):(n=e.label,r=new Date(n)),r.setDate(r.getDate()-14),i="en"===lang?moment(r).format("MMM Do YY"):r.toLocaleString("de",{month:"long",year:"numeric",day:"numeric"}),dictionary.infobox1+i+": "+e.value}}},annotation:{drawTime:"beforeDatasetsDraw",events:["dblclick"],annotations:[{id:"green-box",type:"box",yScaleID:"y-axis-0",yMax:fileresult.features[e.id].properties.greenMaxInhabitants,backgroundColor:greenbox,borderWidth:0},{id:"yellow-box",type:"box",yScaleID:"y-axis-0",yMin:fileresult.features[e.id].properties.greenMaxInhabitants,yMax:fileresult.features[e.id].properties.yellowMaxInhabitants,backgroundColor:yellowbox,borderWidth:0},{id:"red-box",type:"box",yScaleID:"y-axis-0",yMin:fileresult.features[e.id].properties.yellowMaxInhabitants,backgroundColor:redbox,borderWidth:0},{id:"time-line",type:"line",mode:"vertical",scaleID:"x-axis-0",value:formatDate(selectedTimeValue),borderColor:"black",borderWidth:1}]}}})}function onjsonloaded(){4==this.readyState&&200==this.status&&(console.log("data loaded..."),district_map=JSON.parse(this.responseText),loadCSVData(WORLD?"assets/population_countries.csv?t="+now:"doc_info_point/district_data.csv?t="+now,onTableLoaded,","))}function createdistricttable(e){let t=[];for(let n=0;n<e.features.length;n++){let r=e.features[n],i=[];i.push(r.properties.id),i.push(r.properties.name),t.push(i)}saveStringAsFile(Papa.unparse(t),"district_codes_2020.csv")}function toggleLayerVisibility(e){void 0!=map.getLayer(e)?"visible"===map.getLayoutProperty(e,"visibility")?map.setLayoutProperty(e,"visibility","none"):map.setLayoutProperty(e,"visibility","visible"):console.warn("layer "+e+" == UNDEFINED")}function hideLayer(e){map.setLayoutProperty(e,"visibility","none")}function showLayer(e){map.setLayoutProperty(e,"visibility","visible")}function hideAllLayers(e){for(let t=0;t<e.length;t++)hideLayer(e[t])}function encodeDistrictDataLayer(e,t,n,r,i,a,o){map.setPaintProperty("d_map_nodata","fill-color",["interpolate-lab",["linear"],["get",t],n,i,r,a]),createColorLegend(e,{value:n,color:i},{value:r,color:a},5,o)}function switchInfectionLayerEncoding(e,t,n,r,i,a,o=null){createColorLegend(e,{value:n,color:"#fffdfc"},{value:r,color:"#f55a42"},5,o)}function configureSlider(e){dates=getDates(e),timescope=dates.length-15,sliderDate=d3.range(Math.max(0,dates.length-(timescope+1)),dates.length).map(function(e){return Date.parse(dates[e])}),createTimeSlider()}function createTimeSlider(){var e=420,t=d3.select("#timelineSlider-container");window.innerWidth<800?(e=30,t.classed("more-margin",!0)):t.classed("more-margin",!1),null==selectedTimeValue&&(selectedTimeValue=sliderDate[sliderDate.length-1]);var n=sliderDate,r=window.innerWidth-e-100,i=Math.floor(r/62);if(i<sliderDate.length){var a=Math.ceil(sliderDate.length/i);n=n.filter((e,t)=>0===t||t===sliderDate.length-1||t%a==0&&sliderDate.length-a>t)}let o=getTimeFormat();var s=d3.sliderBottom().min(d3.min(sliderDate)).max(d3.max(sliderDate)).width(r).ticks(10).tickFormat(d3.timeFormat(o)).tickValues(n).step(864e5).default(selectedTimeValue).on("onchange",e=>{updateTimelineSlider(e)});t.selectAll("*").remove();var l=(timeSliderContainer=t.append("svg").attr("width",window.innerWidth-e).attr("height",37)).append("g").attr("transform","translate(30,6)");l.call(s),l.selectAll("g.axis g text").attr("dy","0.0em"),l.selectAll("g.slider g text").attr("dy","0.0em")}function calculatePercentile(e){var t=dates[dates.length-2],n=[];return fileresult.features.forEach(e=>{n.push(e.properties.disease[t])}),calcPercentile(n,percentile)}function calculateNewlyInfectedPercentile(e){var t=[];return fileresult.features.forEach(e=>{t.push(e.properties.newInfections)}),calcPercentile(t,percentile)}function updateTimelineSlider(e){if(selectedTimeValue=e,e=sliderDate.indexOf(e),currentSliderIndex=e,fileresult.features.forEach(t=>{t.properties.trend=t.properties.trendarray[e-15],t.properties.trendcolor=t.properties.trendcolorarray[e-15],t.properties.newInfections=t.properties.newInfectionsArray[e],t.properties.growth=t.properties.growthArray[e],t.properties.infectionCount=t.properties.disease[dates[dates.length-1-(timescope-e)]]}),calcSeverity(fileresult.features,csv_table),tweeksago_strng="de"===lang?tweeksago_strngArray[e]:tweeksago_strngArrayUS[e],map.getSource("infection_rates").setData(fileresult),updateLegend(),null!=lastInfoBoxFeature){setInfoBoxContent(generateInfoBoxContent(lastInfoBoxFeature)),setupChart(lastInfoBoxFeature,"myChartInfobx"),updateArrow("trend",fileresult.features[lastInfoBoxFeature.id].properties.trend)}}function updateLegend(){createItemColorLegend(dictionary.legendTitle0+tweeksago_strng+dictionary.legendTitle1,[{color:cgreen,label:dictionary.legendEntry0,label_short:"< 1",label_short_color:"white"},{color:cyellow,label:dictionary.legendEntry1,label_short:"< 10",label_short_color:"black"},{color:cred,label:dictionary.legendEntry2,label_short:">= 10",label_short_color:"white"}])}function resizeWindow(){null!=timeSliderContainer&&createTimeSlider(),window.innerWidth<1e3?d3.select("#info-overlay").classed("mobile",!0):d3.select("#info-overlay").classed("mobile",!1),updateLegend()}function debug(){for(let e=0;e<fileresult.features.length;e++)"Rust(Stadt)"==fileresult.features[e].properties.name&&console.log(fileresult.features[e].properties)}function switchMapLayer(e){map.setPaintProperty("infection_poly","fill-color",["get",e])}function getTimeFormat(){let e="%m/%d/%Y";return e="de"==lang?"%d. %m. %Y":"%m/%d/%Y"}function calcPercentile(e,t){var n=e.sort((e,t)=>e-t),r=e.length,i=r*t;return i!==Math.floor(i)?n[(i=Math.ceil(i))-1]:i<r?.5*(n[i-1]+n[i]):n[i]}function calcGrowRate(e){for(let t=14;t>=0;t--)for(let n=0;n<e.length;n++){let r=e[n].properties.disease,i=[],a=7;for(let e=a;e>0;e--){let n,o=dates.length-2-e-t,s=r[dates[o]];n=0==s?[a-e,s]:[a-e,Math.log(s)],i.push(n)}let o=72*regression.linear(i,{order:2,precision:4}).equation[0]/Math.log(2);isNaN(o)?(console.warn("log of 0 in growthrate calculation..."),e[n].properties.growth=0):e[n].properties.growth=o<0?0:o,e[n].properties.growthArray||(e[n].properties.growthArray=[]),e[n].properties.growthArray.push(e[n].properties.growth),maxGrowth=Math.max(maxGrowth,e[n].properties.growth)}}d3.select(window).on("resize",resizeWindow);var tweeksago_strngArray=[],tweeksago_strngArrayUS=[],date_strngArray=[];function formatDate(e){let t=getTimeFormat();return d3.timeFormat(t)(new Date(e))}function parseDate(e,t){t=t||"yyyy-mm-dd";var n=e.match(/(\d+)/g),r=0,i={};return t.replace(/(yyyy|dd|mm)/g,function(e){i[e]=r++}),new Date(n[i.yyyy],n[i.mm]-1,n[i.dd])}function calcNewInfections(e){for(let t=timescope;t>=0;t--){let n=dates[dates.length-1-t],r=dates[dates.length-15-t];date_strngArray.push(formatDate(n));let i=new Date(r);tweeksago_strngArray.push(i.toLocaleString("de-AT",{month:"long",year:"numeric",day:"numeric"})),tweeksago_strngArrayUS.push(i.toLocaleString("en-US",{month:"long",year:"numeric",day:"numeric"})),tweeksago_strng=i.toLocaleString("de-AT",{month:"long",year:"numeric",day:"numeric"});for(let t=0;t<e.length;t++){let i=e[t].properties.disease[n]-e[t].properties.disease[r];i=i<0?0:i,e[t].properties.newInfectionsArray||(e[t].properties.newInfectionsArray=[],e[t].properties.trendarray=[],e[t].properties.trendcolorarray=[]),e[t].properties.newInfectionsArray.push(i),e[t].properties.newInfections=i}}}function calcMaxNewInfections(e){for(let t=0;t<e.length;t++){e[t].properties.maxNew=Math.max(...e[t].properties.newInfectionsArray);let n=getBevoelkerung(e[t]);e[t].properties.greenMaxInhabitants=1e-4*n,e[t].properties.yellowMaxInhabitants=.001*n,e[t].properties.redMaxInhabitants=Math.max(e[t].properties.maxNew,Math.ceil(.0011*n))}}function calcInfectionTrends(e){e.forEach(e=>{for(let t=14;t<sliderDate.length-1;t++){let n=calcTrendGradient(e,t);e.properties.trendarray.push(n);let r=trendcolorscale(n).hex();e.properties.trendcolorarray.push(r)}})}function calcNewInfectionsTrend(e){for(let t=timescope;t>=0;t--){let n=dates[dates.length-1-t],r=dates[dates.length-15-t];for(let t=0;t<e.length;t++){let i=e[t].properties.disease[n]-e[t].properties.disease[r];i=i<0?0:i,e[t].properties.newInfectionsArrayTrend||(e[t].properties.newInfectionsArrayTrend=[]),e[t].properties.newInfectionsArrayTrend.push(i)}}}function calcTrendGradientForPair(e,t){let n=(1+t)/(1+e)-1,r=Math.atan2(n,1);return r*=-180/Math.PI}function getBevoelkerung(e){let t=e.properties.iso;return WORLD&&(t=e.properties.name),getDistrictInhabsByIso(t)}function calcSeverity(e,t){e.forEach(e=>{const t=e.properties.newInfections/getBevoelkerung(e)*1e4;e.properties.infectionsPerHT=t.toFixed(1),e.properties.severity=t>=10?cred:t>=1?cyellow:cgreen})}function getDistrictInhabsByIso(e){const t=csv_table.find(t=>t[0]===e);var n=0;if(t)n=WORLD?parseInt(t[4].replace(/,/g,"")):t[50];else if(!WORLD)for(let e=901;e<=923;e++)n+=Number.parseInt(csv_table.find(t=>t[0]===""+e)[50]);return n}function calcTrendGradient(e,t){let n=fileresult.features[e.id].properties,r=n.newInfectionsArray[n.newInfectionsArray.length-1+(t-(n.newInfectionsArray.length-1))],i=n.newInfectionsArray[n.newInfectionsArray.length-15+(t-(n.newInfectionsArray.length-1))],a=n.iso;WORLD&&(a=n.name);let o=getDistrictInhabsByIso(a),s=r/o*1e4-i/o*1e4,l=Math.atan(s);return l*=-180/Math.PI}function calcSlopeDegree(e,t,n){let r=(t-e)/n,i=Math.atan(r);return i*=-180/Math.PI}function updateArrow(e,t){if(!TREND_ENABLED)return;let n=document.getElementById(e);isNaN(t)?n.setAttribute("class","hidden"):n.setAttribute("class",""),null!=n&&(n.style.transform="rotate("+t%360+"deg)")}var translations=[{lang:"en",dict:{pageTitle:"CSH Corona Traffic Light",legendTitle0:"Positive tested cases per 10,000 inhabitants within the last 14 days (since ",legendTitle1:")",legendEntry0:"less than 1 positive tested case",legendEntry1:"less than 10 cases tested positive",legendEntry2:"from 10 positive tested cases",welcomeAT0:"Welcome to the CSH Corona Traffic Light",welcomeAT1:'If you move the cursor (mouse) over a district, you see the number of confirmed coronavirus cases since April 2020. Get additional information by clicking on that district.<br><br><b>Please note:</b> We calculate the number of new infections from the difference between the current number of positively tested persons per district and the number of positively tested persons 14 days ago. As the data is continuously updated (also retroactively), the current calculation method may lead to inaccuracies in the calculated number of new infections. The calibration of the corona traffic light (see legend) was chosen arbitrarily and can be adjusted if necessary.<br><br><b>Please note:</b> The relative number of positive tested cases depends on the number of tests performed. In addition to those who test positive, there may always be infected individuals who are asymptomatic, pre-symptomatic or have not been tested for some reason.<br><b>The relative number of positively tested cases therefore does not correspond to the "true" risk of infection.</b>  However, if we assume a constant number of tests is performed over time, the numbers shown in the graphs should be representative for the infection trend in the respective district.<br><br>Information on data sources, further disclaimers, as well as the <b>color blind compatibility mode</b> can be obtained by clicking on the ? button.',welcomeGlobal0:"Welcome to the CSH Corona Traffic Light",welcomeGlobal1:'If you move the cursor (mouse) over a country, you see the number of confirmed coronavirus cases since February 2020. Get additional information by clicking on that country.<br><br><b>Please note:</b> We calculate the number of new infections from the difference between the current number of positively tested persons per district and the number of positively tested persons 14 days ago. The calibration of the corona traffic light (see legend) was chosen arbitrarily and can be adjusted if necessary.<br><br><b>Please note:</b> The relative number of positive tested cases depends on the number of tests performed. In addition to those who test positive, there may always be infected individuals who are asymptomatic, pre-symptomatic or have not been tested for some reason. Please also take into account that testing and reporting differs from country to country.<br><b>The relative number of positively tested cases therefore does not correspond to the "true" risk of infection.</b>  However, if we assume that a country performs a constant number of tests over time, the numbers shown in the graphs should be representative for the infection trend.<br><br>Information on data sources, further disclaimers, as well as the <b>color blind compatibility mode</b> can be obtained by clicking on the ? button.',popup0:" positive cases per 10,000 inhabitants since ",popup1:"Cases tested positive within the last 14 days",infobox0:"Total number of cases tested positive",infobox1:"Cases tested positive since ",infobox2:"Total population",infobox3:"Cases tested positive within the last 14 days",infobox4:"Num. of general practitioners (GPs):",infobox5:"GPs per 10,000 inhabitants:",infobox6:"Num. of inhabitants (65+) with underlying health conditions:",infobox7:"Perc. of inhabitants (65+) with underlying health conditions:",tooltipDisclaimer:"Disclaimer",tooltipLegend0:"Positive tested cases per 10,000 inhabitants within the last 14 days (since",tooltipLegend1:")",disclaimerAustriaTitle:"Disclaimer",disclaimerAustriaContent:'Sources: BMSGPK, Austrian COVID-19 Open Data Informationsportal (<a href="https://www.data.gv.at/covid-19" target="_blank">https://www.data.gv.at/covid-19</a>).<br>Statistik Austria - <a href="https://data.statistik.gv.at" target="_blank">data.statistik.gv.at</a><br><br>This work is supported by the <a href="https://www.wwtf.at" target="_blank">Wiener Wissenschafts-, Forschungs- und Technologiefonds (WWTF)</a> projects #COV20-017 “Tagesaktuelle Coronalagekarte” and the Österreichische Forschungsförderungsgesellschaft project #873927.<br><br>We extend our thanks to the <a href="https://www.mapbox.com/community/" target="_blank">Mapbox Community</a> for their generous support.<br><br>Credits: Martin Sprenger, Johannes Sorger, Wolfgang Knecht, Martin Knecht, Peter Klimek</p> <a href="https://www.wwtf.at" target="_blank"><img src="assets/wwtf.zweizeilig.RGB.jpg" width="200"></a>',disclaimerGlobalTitle:"Disclaimer",disclaimerGlobalContent:'Sources: COVID-19 Data Repository by the Center for Systems Science and Engineering (CSSE) at Johns Hopkins University (<a href="https://github.com/CSSEGISandData/COVID-19" target="_blank">https://github.com/CSSEGISandData/COVID-19</a>).<br><br>List of countries by population (United Nations) - <a href="https://en.wikipedia.org/wiki/List_of_countries_by_population_(United_Nations)" target="_blank">https://en.wikipedia.org/wiki/List_of_countries_by_population_(United_Nations)</a><br><br>This work is supported by the <a href="https://www.wwtf.at" target="_blank">Wiener Wissenschafts-, Forschungs- und Technologiefonds (WWTF)</a> projects #COV20-017 “Tagesaktuelle Coronalagekarte”and the Österreichische Forschungsförderungsgesellschaft project #873927.<br><br>We extend our thanks to the <a href="https://www.mapbox.com/community/" target="_blank">Mapbox Community</a> for their generous support.<br><br>Credits: Stefan Thurner, Johannes Sorger, Wolfgang Knecht, Martin Knecht, Martin Sprenger, Peter Klimek</p> <a href="https://www.wwtf.at" target="_blank"><img src="assets/wwtf.zweizeilig.RGB.jpg" width="200"></a>',options0:"Options",options0:"Color Blind Mode"}},{lang:"de",dict:{pageTitle:"CSH Corona-Ampel",legendTitle0:"Positiv getestete Fälle pro 10.000 EinwohnerInnen innerhalb der letzen 14 Tage (seit ",legendTitle1:")",legendEntry0:"weniger als 1 positiv getesteter Fall",legendEntry1:"weniger als 10 positiv getestete Fälle",legendEntry2:"ab 10 positiv getesteten Fällen",welcomeAT0:"Willkommen zur CSH Corona-Ampel",welcomeAT1:"Wenn Sie den Cursor (Maus) über einen Bezirk bewegen, sehen Sie die Anzahl der bestätigten Coronavirus-Fälle seit April 2020. Wenn Sie auf den jeweiligen Bezirk klicken, erhalten Sie weitere Informationen.<br><br><b>Bitte beachten Sie:</b> Die Zahl der Neuinfektionen wird aus der Differenz zwischen der aktuellen Zahl der positiv getesteten Personen pro Bezirk und der Zahl der positiv getesteten Personen vor 14 Tagen berechnet. Da die Daten laufend (oft auch rückwirkend) aktualisiert werden, kann die aktuelle Berechnungsmethode zu Ungenauigkeiten bei der errechneten Anzahl an Neuinfektionen führen. Die Kalibrierung der Corona-Ampel wurde willkürlich gewählt und kann bei Bedarf angepasst werden.<br><br><b>Bitte beachten Sie:</b> die relative Anzahl der positiv getesteten Fälle ist abhängig von der Anzahl der durchgeführten Tests. Neben den positiv getesteten Personen kann es auch immer infizierte Personen geben, die asymptomatisch oder präsymptomatisch sind oder die aus irgendeinem Grund nicht getestet wurden. <b>Die relative Anzahl der positiv getesteten Fälle entspricht somit nicht dem „wahren“ Infektionsrisiko.</b> Wenn wir jedoch davon ausgehen, dass ein Bezirk über die Zeit hinweg eine konstante Anzahl von Tests durchführt, sollten die in den Grafiken dargestellten Zahlen repräsentativ sein für den Infektionstrend im jeweiligen Bezirk.<br><br>Für Informationen zu Datenquellen, weitere Disclaimer, und dem <b>Kompatibilitätsmodus für Farbenschwäche</b>, klicken Sie auf den ?-Button.",welcomeGlobal0:"Willkommen zur CSH Corona-Ampel",welcomeGlobal1:"Wenn Sie den Cursor (Maus) über ein Land bewegen, sehen Sie die Anzahl der bestätigten Coronavirus-Fälle seit Februar 2020. Wenn Sie auf das jeweilige Land klicken, erhalten Sie weitere Informationen.<br><br><b>Bitte beachten Sie:</b> Die Zahl der Neuinfektionen wird aus der Differenz zwischen der aktuellen Zahl der positiv getesteten Personen pro Land und der Zahl der positiv getesteten Personen vor 14 Tagen berechnet. Die Kalibrierung der Corona-Ampel wurde willkürlich gewählt und kann bei Bedarf angepasst werden.<br><br><b>Bitte beachten Sie:</b> die relative Anzahl der positiv getesteten Fälle ist abhängig von der Anzahl der durchgeführten Tests. Neben den positiv getesteten Personen kann es auch immer infizierte Personen geben, die asymptomatisch oder präsymptomatisch sind oder die aus irgendeinem Grund nicht getestet wurden. Bitte beachten Sie auch, dass sich Teststrategien von Land zu Land unterscheiden. <b>Die relative Anzahl der positiv getesteten Fälle entspricht somit nicht dem „wahren“ Infektionsrisiko.</b> Wenn wir jedoch davon ausgehen, dass ein Land über die Zeit hinweg eine konstante Anzahl von Tests durchführt, sollten die in den Grafiken dargestellten Zahlen repräsentativ sein für den Infektionstrend im jeweiligen Land.<br><br>Für Informationen zu Datenquellen, weitere Disclaimer, und dem <b>Kompatibilitätsmodus für Farbenschwäche</b>, klicken Sie auf den ?-Button.",popup0:" positiv getestete Fälle pro 10.000 EinwohnerInnen seit ",popup1:"Positiv Getestete innerhalb von 14 Tagen",infobox0:"Anzahl positiv Getesteter (insgesamt)",infobox1:"Anzahl positiv Getesteter seit ",infobox2:"Gesamtbevölkerung",infobox3:"Positiv Getestete innerhalb von 14 Tagen",infobox4:"Anzahl Allgemeinmediziner:",infobox5:"Allgemeinmediziner pro Tsd EinwohnerInnen:",infobox6:"Anzahl Personen mit Vorerkrankungen 65+:",infobox7:"Prozent Personen mit Vorerkrankungen 65+:",tooltipDisclaimer:"Infos zu Datenquellen und Fördergebern",tooltipLegend0:"Positiv getestete Fälle pro 10.000 EinwohnerInnen innerhalb der letzen 14 Tage (seit ",tooltipLegend1:")",disclaimerAustriaTitle:"Disclaimer",disclaimerAustriaContent:'Datenquelle: BMSGPK, Österreichisches COVID-19 Open Data Informationsportal (<a href="https://www.data.gv.at/covid-19" target="_blank">https://www.data.gv.at/covid-19</a>).<br><i>Die Wachstumsraten beziehen sich auf die gemessene tägliche Steigerung der Anzahl der positiv getesteten Personen, gemittelt über die letzten zwei Wochen.</i><br>Datenquelle: Statistik Austria - <a href="https://data.statistik.gv.at" target="_blank">data.statistik.gv.at</a><br><br>Wir bedanken uns für die Unterstützung des <a href="https://www.wwtf.at" target="_blank">Wiener Wissenschafts-, Forschungs- und Technologiefonds (WWTF)</a> im Rahmen der "COVID-19 Rapid Response Förderung" im Projekt "Tagesaktuelle Coronalagekarte". Dieses Projekt wurde zum Teil durch das FFG Projekt #873927 unterstützt.<br><br>Wir bedanken uns weiters für die Unterstützung durch die <a href="https://www.mapbox.com/community/" target="_blank">Mapbox Community</a>.<br><br>Gestaltung: Martin Sprenger, Johannes Sorger, Wolfgang Knecht, Martin Knecht, Peter Klimek</p> <a href="https://www.wwtf.at" target="_blank"><img src="assets/wwtf.zweizeilig.RGB.jpg" width="200"></a>',disclaimerGlobalTitle:"Disclaimer",disclaimerGlobalContent:'Datenquelle: COVID-19 Data Repository by the Center for Systems Science and Engineering (CSSE) at Johns Hopkins University (<a href="https://github.com/CSSEGISandData/COVID-19" target="_blank">https://github.com/CSSEGISandData/COVID-19</a>).<br><i>Die Wachstumsraten beziehen sich auf die gemessene tägliche Steigerung der Anzahl der positiv getesteten Personen, gemittelt über die letzten zwei Wochen.</i><br>Datenquelle: List of countries by population (United Nations) - <a href="https://en.wikipedia.org/wiki/List_of_countries_by_population_(United_Nations)" target="_blank">https://en.wikipedia.org/wiki/List_of_countries_by_population_(United_Nations)</a><br><br>Wir bedanken uns für die Unterstützung des <a href="https://www.wwtf.at" target="_blank">Wiener Wissenschafts-, Forschungs- und Technologiefonds (WWTF)</a> im Rahmen der "COVID-19 Rapid Response Förderung" im Projekt "Tagesaktuelle Coronalagekarte" COV20-017. Dieses Projekt wurde zum Teil durch das FFG Projekt #873927 unterstützt.<br><br>Wir bedanken uns weiters für die Unterstützung durch die <a href="https://www.mapbox.com/community/" target="_blank">Mapbox Community</a>.<br><br>Gestaltung: Stefan Thurner, Johannes Sorger, Wolfgang Knecht, Martin Knecht, Martin Sprenger, Peter Klimek</p> <a href="https://www.wwtf.at" target="_blank"><img src="assets/wwtf.zweizeilig.RGB.jpg" width="200"></a>',options0:"Optionen",options0:"Farbenblind"}}],dictionary=null,lang="de";function initTranslations(){var e=getCookie("lang");console.log(e),""!==e&&"en"===e&&"de"===e||(e=WORLD?"en":"de"),"de"===(lang=(lang=getUrlParam("lang",e)).substring(0,2))?moment.locale("de"):moment.locale("en"),USECOOKIES&&setCookie("lang",lang,365),dictionary=translations.filter(e=>e.lang==lang)[0].dict,console.log("init translations"),d3.selectAll("[data-translation]").each(function(){d3.select(this).html(dictionary[d3.select(this).attr("data-translation")])}),d3.select("#lang-"+lang).style("font-weight","bold")}function getUrlParam(e,t){var n=t;return window.location.href.indexOf(e)>-1&&(n=getUrlVars()[e]),n}function getUrlVars(){var e={};window.location.href.replace(/[?&]+([^=&]+)=([^&]*)/gi,function(t,n,r){e[n]=r});return e}function showDisclaimer(){var e=document.querySelector("#disclaimer-modal");WORLD&&(e=document.querySelector("#disclaimer-modal-global")),M.Modal.getInstance(e).open()}function showTimeline(){d3.select("#timelineSlider-container").classed("collapsed",!1)}function hideTimeLine(){d3.select("#timelineSlider-container").classed("collapsed",!0),setTimeout(function(){map.resize()},500)}function createColorLegend(e,t,n,r,i=null){var a=d3.select("#color_legend");a.selectAll("*").remove(),null!=e&&a.append("div").text(e).attr("class","legend-unit"),null!=i?a.attr("data-tooltip",i):a.attr("data-tooltip",e);var o=(n.value-t.value)/(r-1),s=28*r;createColorGradient(a.append("div").attr("class","color-legend-gradient-container").style("width",s).style("height",10).node(),t,n,50,s,9);for(var l=0;l<r;l++){var d=a.append("div").attr("class","color-legend-item"),c=t.value+o*l;c=o>=1?Math.floor(c):c.toLocaleString(lang,{maximumFractionDigits:1}),d.append("div").text(c).attr("class","legend-label")}a.style("display","block")}function createColorGradient(e,t,n,r,i,a){let o=chroma.scale([t.color,n.color]).domain([t.value,n.value]).mode("lab");var s=i,l=a,d=createSamplesFromScale(r,o);o.domain();var c=d3.select(e).append("svg");c.attr("width",i).attr("height",a).attr("class","color-legend-gradient");var u=c.append("g");u.attr("width",s).attr("height",l),u.selectAll("rect").data(d).enter().append("rect").attr("x",function(e,t){return t*(s/d.length)}).attr("y",function(e){return 0}).attr("width",s/d.length- -1).attr("height",function(e){return l}).attr("fill",function(e){return e.toString()})}function createSamplesFromScale(e,t){for(var n=[],r=t.domain?t.domain():[0,1],i=Math.min(r[0],r[r.length-1]),a=Math.max(r[r.length-1],r[0]),o=0;o<e;o++)n.push(t(i+o/e*(a-i)));return n}function createItemColorLegend(e,t,n=null){var r=d3.select("#color_legend");r.selectAll("*").remove(),null!=e&&r.append("div").text(e).attr("class","legend-unit"),null!=n?r.attr("data-tooltip",n):r.attr("data-tooltip",e);var i,a=window.innerHeight<800;i=a?r.append("div"):r.append("ul"),t.forEach(e=>{if(a)i.append("span").attr("class","color-legend-color mobile").text(e.label_short).style("background-color",e.color).style("color",e.label_short_color);else{const t=i.insert("li");t.append("span").attr("class","color-legend-color").text(" ").style("background-color",e.color),t.append("span").text(e.label).attr("class","color-legend-label")}})}function showInfoBox(e){setInfoBoxContent(e),d3.select("#info-overlay").style("right","0px"),initToolTips()}function setInfoBoxContent(e){d3.select("#info-overlay div").html(e),initToolTips()}function hideInfoBox(){d3.select("#info-overlay").style("right","-580px")}function getDivWidth(e){var t=d3.select(e).style("width").slice(0,-2);return Math.round(Number(t))}function initToolTips(){document.querySelectorAll(".material-tooltip").forEach(function(e){e.parentNode.removeChild(e)});var e=document.querySelectorAll(".tooltipped");M.Tooltip.init(e,{})}document.addEventListener("DOMContentLoaded",function(){d3.select("#info-overlay-close").on("click",hideInfoBox);var e=document.querySelectorAll(".modal");M.Modal.init(e,{onCloseEnd:function(){USECOOKIES&&setCookie("disclaimer","showed",30)}});var t=document.querySelectorAll(".tooltipped");M.Tooltip.init(t,{enterDelay:100});TREND_ENABLED&&d3.select("#amp_radio").classed("visible",!0)});